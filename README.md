Java Panama Rust Demo
===================

Use Java 22 [JEP 454: Foreign Function & Memory API](https://openjdk.org/jeps/454) to call Rust functions by FFI.

# Requirements

* JDK 22: https://jdk.java.net/22/
* GraalVM 22: https://www.graalvm.org/
* jextract: https://github.com/openjdk/jextract
* Rust: https://rustup.rs/

# Project structure

* `src/main/rust`: Rust library cdylib source code with FFI
* `src/main/java`: Java source code to call Rust functions by FFI

# How it works

1. Write Rust functions with `#[no_mangle]` and `extern "C"` attributes.
2. Build Rust functions as a shared library with `cdylib` crate type.
3. Generate lib.h header file with `cbindgen` tool for Rust FFI functions.
4. Use `jextract` tool to generate Java bindings from the header file and shared library.
5. Write Java code to call the stub functions generated by `jextract`.

# GraalVM native-image support

Please refer [Foreign Function and Memory API in Native Image](https://www.graalvm.org/latest/reference-manual/native-image/native-code-interoperability/foreign-interface/)

# Install jextract from source code

```shell
$ git clone https://github.com/openjdk/jextract.git
$ cd jextract
$ ./gradlew -Pjdk22_home=$HOME/.jbang/cache/jdks/22 -Pllvm_home=/Library/Developer/CommandLineTools/usr/ clean verify
$ cp -r build/jextract ~/tools/jextract
```

# References

* Welcome, GraalVM for JDK 22! https://medium.com/graalvm/welcome-graalvm-for-jdk-22-8a48849f054c
* Java Foreign Function Interface with RocksDB: https://rocksdb.org/blog/2024/02/20/foreign-function-interface.html